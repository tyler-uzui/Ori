<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OriBastiGHG Secret</title>
<style>
  body {
    background-color: #111;
    color: #0f0;
    font-family: monospace;
    text-align: center;
    padding: 50px;
  }

  pre {
    background-color: #000;
    color: #0f0;
    padding: 20px;
    border-radius: 10px;
    display: inline-block;
    margin-bottom: 20px;
  }

  input[type="text"] {
    background-color: #222;
    color: #0f0;
    border: 1px solid #0f0;
    padding: 5px 10px;
    border-radius: 5px;
    font-family: monospace;
    margin: 5px 0;
  }

  input[type="submit"], button {
    background-color: #0f0;
    color: #111;
    padding: 5px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
  }

  input[type="submit"]:hover, button:hover {
    background-color: #0c0;
  }

  #feedback {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 20px 30px;
    border-radius: 10px;
    display: none;
    font-weight: bold;
    text-align: center;
    white-space: pre-line;
    font-size: 18px;
    z-index: 9999;
  }

  .correct {
    background-color: #0c0;
    color: #111;
  }

  .incorrect {
    background-color: #c00;
    color: #fff;
  }

  #adminSection {
    display: none;
    margin-top: 10px;
  }

  #adminAttemptsDisplay {
    margin-bottom: 5px;
    color: #0f0;
  }

  #adminLockDisplay {
    color: #0f0;
    margin-top: 5px;
  }

  #attemptsDisplay {
    margin-bottom: 15px;
  }
</style>
</head>
<body>

<h1>OriBastiGHG Secret</h1>

<pre id="binary">
01001011 01100101 
01101110 01100111 
00001010 01001111 
01110010 01101001
</pre>

<p id="attemptsDisplay">Attempts left: 5</p>

<form id="codeForm">
  <label for="benutzer">BenutzerID:</label><br>
  <input type="text" id="benutzer" placeholder="Benutzer-Id"><br>

  <label for="code">Code:</label><br>
  <input type="text" id="code" placeholder="Code"><br>

  <input type="submit" value="Absenden">
</form>

<div id="adminSection">
  <p id="adminAttemptsDisplay">Admin attempts left: 3</p>
  <input type="text" id="adminInput" placeholder="Admin-Code eingeben">
  <button id="adminSubmit">Submit</button>
  <p id="adminLockDisplay"></p>
</div>

<div id="feedback">
Incorrect code
!!warning!!
</div>

<script>
const correctUser = "Keng";
const correctCode = "Ori";
const adminCode = "Tyler";
const maxAttempts = 5;
const maxAdminAttempts = 3;

let attempts = parseInt(localStorage.getItem('attempts')) || 0;
let lockUntil = parseInt(localStorage.getItem('lockUntil')) || 0;
let adminAttempts = parseInt(localStorage.getItem('adminAttempts')) || maxAdminAttempts;

const form = document.getElementById("codeForm");
const feedback = document.getElementById("feedback");
const attemptsDisplay = document.getElementById("attemptsDisplay");
const adminSection = document.getElementById("adminSection");
const adminInput = document.getElementById("adminInput");
const adminSubmit = document.getElementById("adminSubmit");
const adminAttemptsDisplay = document.getElementById("adminAttemptsDisplay");
const adminLockDisplay = document.getElementById("adminLockDisplay");

function updateAttempts() {
  attemptsDisplay.textContent = "Attempts left: " + Math.max(0, maxAttempts - attempts);
}

function updateAdminAttempts() {
  adminAttemptsDisplay.textContent = "Admin attempts left: " + Math.max(0, adminAttempts);
}

function formatTime(seconds){
  let m = Math.floor(seconds/60);
  let s = seconds % 60;
  return m.toString().padStart(2,'0') + ":" + s.toString().padStart(2,'0');
}

function checkLock() {
  const now = Date.now();
  if(lockUntil && now < lockUntil){
    const remaining = Math.ceil((lockUntil - now)/1000);
    form.style.display = "none";
    attemptsDisplay.style.display = "none";
    adminSection.style.display = "block";
    adminInput.style.display = adminAttempts > 0 ? "block" : "none";
    adminLockDisplay.textContent = "Locked for: " + formatTime(remaining);
    return remaining;
  } else {
    lockUntil = 0;
    localStorage.removeItem('lockUntil');
    form.style.display = "block";
    attemptsDisplay.style.display = "block";
    adminSection.style.display = "none";
    adminLockDisplay.textContent = "";
    attempts = 0;
    localStorage.setItem('attempts', attempts);
    adminAttempts = maxAdminAttempts;
    localStorage.setItem('adminAttempts', adminAttempts);
    updateAttempts();
    updateAdminAttempts();
    return 0;
  }
}

let lockTimer = null;
function startLockCountdown() {
  if(lockTimer) clearInterval(lockTimer);
  lockTimer = setInterval(() => {
    let remaining = checkLock();
    if(remaining <= 0){
      clearInterval(lockTimer);
      adminInput.value = "";
    }
  }, 1000);
}

updateAttempts();
updateAdminAttempts();
checkLock();
startLockCountdown();

form.addEventListener("submit", function(e){
  e.preventDefault();
  if(lockUntil && Date.now() < lockUntil) return;

  const benutzer = document.getElementById("benutzer").value;
  const code = document.getElementById("code").value;

  if(benutzer === correctUser && code === correctCode){
    feedback.textContent = "Access granted âœ…";
    feedback.className = "correct";
    feedback.style.display = "block";
    setTimeout(() => window.location.href = "info.html", 700);
  } else {
    attempts++;
    localStorage.setItem('attempts', attempts);
    updateAttempts();
    feedback.textContent = "Incorrect code\n!!warning!!";
    feedback.className = "incorrect";
    feedback.style.display = "block";
    setTimeout(() => { if(!lockUntil) feedback.style.display = "none"; }, 700);

    if(attempts >= maxAttempts){
      const now = Date.now();
      lockUntil = now + 10*60*1000; // 10 Minuten
      localStorage.setItem('lockUntil', lockUntil);
      form.style.display = "none";
      attemptsDisplay.style.display = "none";
      adminSection.style.display = "block";
      adminInput.style.display = "block";
      adminLockDisplay.textContent = "Locked for: 10:00\nAdmin code to unlock:";
      startLockCountdown();
    }
  }
});

adminSubmit.addEventListener("click", function(){
  if(lockUntil && Date.now() < lockUntil && adminAttempts > 0){
    const entered = adminInput.value;
    if(entered === adminCode){
      lockUntil = 0;
      localStorage.removeItem('lockUntil');
      attempts = 0;
      localStorage.setItem('attempts', attempts);
      form.style.display = "block";
      attemptsDisplay.style.display = "block";
      adminSection.style.display = "none";
      adminLockDisplay.textContent = "";
      adminInput.value = "";
      adminAttempts = maxAdminAttempts;
      localStorage.setItem('adminAttempts', adminAttempts);
      updateAdminAttempts();
      alert("Admin-Code accepted! You can try again.");
    } else {
      adminAttempts--;
      localStorage.setItem('adminAttempts', adminAttempts);
      updateAdminAttempts();
      adminLockDisplay.textContent = "Incorrect Admin-Code!";
      if(adminAttempts <= 0){
        adminInput.style.display = "none";
        const now = Date.now();
        lockUntil = now + (10+60)*60*1000; // 10 Minuten + 1 Stunde
        localStorage.setItem('lockUntil', lockUntil);
        startLockCountdown();
        alert("Admin-Code limit reached. Page closing and 1 hour added to lock.");
        window.close();
      }
    }
  }
});
</script>
</body>
</html>