<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OriBastiGHG Secret</title>
<style>
  body {
    background-color: #111;
    color: #0f0;
    font-family: monospace;
    text-align: center;
    padding: 50px;
  }

  pre {
    background-color: #000;
    color: #0f0;
    padding: 20px;
    border-radius: 10px;
    display: inline-block;
    margin-bottom: 20px;
  }

  input[type="text"] {
    background-color: #222;
    color: #0f0;
    border: 1px solid #0f0;
    padding: 5px 10px;
    border-radius: 5px;
    font-family: monospace;
    margin: 5px 0;
  }

  input[type="submit"], button {
    background-color: #0f0;
    color: #111;
    padding: 5px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
  }

  input[type="submit"]:hover, button:hover {
    background-color: #0c0;
  }

  #feedback {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 20px 30px;
    border-radius: 10px;
    display: none;
    font-weight: bold;
    text-align: center;
    white-space: pre-line;
    font-size: 18px;
    z-index: 9999;
  }

  .correct {
    background-color: #0c0;
    color: #111;
  }

  .incorrect {
    background-color: #c00;
    color: #fff;
  }

  #adminSection {
    display: none;
    margin-top: 10px;
  }

  #adminAttemptsDisplay {
    margin-bottom: 5px;
    color: #0f0;
  }

  #adminLockDisplay {
    color: #0f0;
    margin-top: 5px;
  }

  #attemptsDisplay {
    margin-bottom: 15px;
  }
</style>
</head>
<body>

<h1>OriBastiGHG Secret</h1>

<pre id="binary">
01001011 01100101 
01101110 01100111 
00001010 01001111 
01110010 01101001
</pre>

<p id="attemptsDisplay">Attempts left: 5</p>

<form id="codeForm">
  <label for="benutzer">BenutzerID:</label><br>
  <input type="text" id="benutzer" placeholder="Benutzer-Id"><br>

  <label for="code">Code:</label><br>
  <input type="text" id="code" placeholder="Code"><br>

  <input type="submit" value="Absenden">
</form>

<div id="adminSection">
  <p id="adminAttemptsDisplay">Admin attempts left: 3</p>
  <input type="text" id="adminInput" placeholder="Admin-Code eingeben">
  <button id="adminSubmit">Submit</button>
  <p id="adminLockDisplay"></p>
</div>

<div id="feedback">
Incorrect code
!!warning!!
</div>

<script>
// Beim Sperren speichern wir den Endzeitpunkt der Sperre
function startLockTimer(seconds) {
  const unlockTime = Date.now() + seconds * 1000; // Sperre bis X Uhrzeit
  localStorage.setItem("oriLockTime", unlockTime);
  lockSeconds = seconds;
  lock = true;

  lockTimer = setInterval(() => {
    const now = Date.now();
    lockSeconds = Math.max(0, Math.floor((unlockTime - now)/1000));
    if(lockSeconds <= 0) {
      clearInterval(lockTimer);
      lock = false;
      adminInput.style.display = "block"; // wieder sichtbar
      localStorage.removeItem("oriLockTime");
      attempts = 0;
      adminAttempts = 3;
      updateAdminAttempts();
    }
  }, 1000);
}

// Beim Laden prüfen, ob noch Sperre aktiv ist
window.addEventListener("load", () => {
  const savedTime = localStorage.getItem("oriLockTime");
  if(savedTime) {
    const remaining = Math.floor((savedTime - Date.now()) / 1000);
    if(remaining > 0) {
      startLockTimer(remaining);
      adminInput.style.display = "none"; // während Sperre Input ausblenden
      lock = true;
    } else {
      localStorage.removeItem("oriLockTime");
    }
  }
});
const correctUser = "Keng";
const correctCode = "Ori";
const adminCode = "Tyler";

let attempts = 0;
let maxAttempts = 5;
let lock = false;
let lockSeconds = 0; // Sperre in Sekunden
let adminAttempts = 3;
let lockTimer = null;

const form = document.getElementById("codeForm");
const feedback = document.getElementById("feedback");
const binary = document.getElementById("binary");
const attemptsDisplay = document.getElementById("attemptsDisplay");
const adminSection = document.getElementById("adminSection");
const adminInput = document.getElementById("adminInput");
const adminSubmit = document.getElementById("adminSubmit");
const adminAttemptsDisplay = document.getElementById("adminAttemptsDisplay");
const adminLockDisplay = document.getElementById("adminLockDisplay");

function updateAttempts() {
  attemptsDisplay.textContent = "Attempts left: " + Math.max(0, maxAttempts - attempts);
}

function updateAdminAttempts() {
  adminAttemptsDisplay.textContent = "Admin attempts left: " + Math.max(0, adminAttempts);
}

function formatTime(seconds) {
  const m = Math.floor(seconds / 60);
  const s = seconds % 60;
  return m + "m " + s + "s";
}

function startLockTimer(seconds) {
  lockSeconds = seconds;
  lockTimer = setInterval(() => {
    lockSeconds--;
    if(lockSeconds <= 0){
      clearInterval(lockTimer);
      lockTimer = null;
      lock = false;
      attempts = 0;
      updateAttempts();
      form.style.display = "block";
      attemptsDisplay.style.display = "block";
      adminSection.style.display = "none";
      adminLockDisplay.textContent = "";
      adminAttempts = 3;
      updateAdminAttempts();
      adminInput.style.display = "block";
      adminSubmit.style.display = "inline-block";
    } else {
      adminLockDisplay.textContent = "Locked: " + formatTime(lockSeconds);
    }
  }, 1000);
}

form.addEventListener("submit", function(e){
  e.preventDefault();
  if(lock) return;

  const benutzer = document.getElementById("benutzer").value;
  const code = document.getElementById("code").value;

  if(benutzer === correctUser && code === correctCode){
    feedback.textContent = "Access granted ✅";
    feedback.className = "correct";
    feedback.style.display = "block";
    setTimeout(() => window.location.href = "info.html", 700);
  } else {
    attempts++;
    updateAttempts();
    feedback.textContent = "Incorrect code\n!!warning!!";
    feedback.className = "incorrect";
    feedback.style.display = "block";
    setTimeout(() => { if(!lock) feedback.style.display = "none"; }, 700);

    if(attempts >= maxAttempts){
      lock = true;
      form.style.display = "none";
      attemptsDisplay.style.display = "none";
      feedback.style.display = "none";
      adminSection.style.display = "block";
      adminAttempts = 3;
      updateAdminAttempts();

      startLockTimer(600); // 10 Minuten
    }
  }
});

// Admin-Code Event
adminSubmit.addEventListener("click", function() {
  const entered = adminInput.value.trim();

  if(entered === adminCode){
    lock = false;
    attempts = 0;
    form.style.display = "block";
    attemptsDisplay.style.display = "block";
    feedback.style.display = "none";
    adminSection.style.display = "none";
    adminLockDisplay.textContent = "";
    adminAttempts = 3;
    updateAdminAttempts();
    adminInput.value = "";
    alert("Admin-Code accepted! You can try again.");
  } else {
    adminAttempts--;
    updateAdminAttempts();
    adminLockDisplay.textContent = "Incorrect Admin-Code!";

    if(adminAttempts <= 0){
      // Admin-Feld + Button ausblenden
      adminInput.style.display = "none";
      adminSubmit.style.display = "none";

      // Sperre: 1 Stunde auf bestehenden Timer draufpacken
      let totalLock = lockSeconds + 3600;
      startLockTimer(totalLock);

      alert("Admin-Code limit reached. Page closing.");
      window.close();
    }
  }
});
</script>

</body>
</html>